<main class="flex flex-col -mx-3">
  <!--Forms-->
  <p-toast></p-toast>
  <!--End Forms-->

  <p-confirmDialog></p-confirmDialog>

  @if(geometries$() | async; as geometries ){
    <app-table
      (pageSelectedOutput)="onPaginationChanged($event)"
      (searchValueOutput)="onSearchChanged($event)"
      (perPageOutput)="onChangeEntryPerPage($event)"
      (sortValueOutput)="onSortChanged($event)"
      (reloadTableData)="onReloadTableData($event)"
      [perPage]="perPage"
      [pageSelected]="pageSelected"
      [searchValue]="searchValue"
      [sortColumnSelected]="sortValue"
      [tableName]="tableName"
      [dynamicComponent]="GeometryFormComponent"
      [myService$]="geometries"
      [headers]="headers">
      <tbody tbody>
        @if (geometries.data; as geometryData){
          @for (geometryItem of geometryData | filter: searchValue : ['name','reference'] | sort:sortValue.order:sortValue.field ;track geometryItem.uuid) {
            <tr>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                <div class="flex px-2">
                  <div class="my-auto">
                    <h6 class="mb-0 text-sm leading-normal">{{ geometryItem.name }}</h6>
                  </div>
                </div>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                <p class="mb-0 text-sm font-semibold leading-normal">{{ geometryItem.reference }}</p>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                      <span class="mb-0 text-sm font-semibold leading-normal flex space-x-1.5 items-center ">
                        <div  [ngStyle]="{'background-color':geometryItem.color} " class=" rounded-full border w-4 h-4"></div>
                        {{ geometryItem.color }}
                      </span>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                <p class="mb-0 text-sm font-semibold leading-normal">{{ geometryItem.type }}</p>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                <span class="text-xs font-semibold leading-tight">{{ geometryItem._count.coordinates }}</span>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                <select class="text-xs font-semibold leading-tight">
                  @if (geometryItem.coordinates.length > 0) {
                    @for (coordinateItem  of geometryItem.coordinates;track coordinateItem) {
                      <option value="{{ coordinateItem.coordinate_uuid }}"> {{ coordinateItem.coordinate_uuid }}
                      </option>
                    }
                  } @else {
                    <option value="null">station not found</option>
                  }
                </select>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                <div class="flex space-x-1.5 items-center justify-center">
                  <a (click)="onShowDialog(geometryItem)" class="cursor-pointer text-xs font-semibold leading-tight text-slate-400"> <i class="pi pi-file-edit"></i> </a>
                  <a (click)="onConfirmDelete(geometryItem.uuid)" class=" cursor-pointer text-xs font-semibold leading-tight text-slate-400"> <i class="pi pi-trash"></i> </a>
                  <a  class="cursor-pointer text-xs font-semibold leading-tight text-slate-400">
                    <i class="pi pi-eye"></i>
                  </a>
                </div>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="8" class="w-full px-6 py-3 text-xs font-semibold leading-normal text-center bg-transparent border-t border-gray-200 shadow-none whitespace-nowrap">
                <div class="w-full flex flex-row justify-center items-center px-2 ">
                  <div class="">No data found</div>
                </div>
              </td>
            </tr>
          }
        }
      </tbody>

    </app-table>
  }
</main>
