<main class="flex flex-col -mx-3">
  <!--Forms-->
  <p-toast></p-toast>
  <!--End Forms-->

  <p-confirmDialog></p-confirmDialog>

  @if(geometries$() | async; as geometries ){
    <app-table
      (pageSelectedOutput)="onPaginationChanged($event)"
      (searchValueOutput)="onSearchChanged($event)"
      (perPageOutput)="onChangeEntryPerPage($event)"
      (sortValueOutput)="onSortChanged($event)"
      (reloadTableData)="onReloadTableData($event)"
      (selectAllData)="onSelectAllData($event)"
      (multipleDeleteData)="onMultipleDeleteData($event)"
      [nbItemToDelete]="removeList().length"
      [perPage]="perPage"
      [pageSelected]="pageSelected"
      [searchValue]="searchValue"
      [sortColumnSelected]="sortValue"
      [tableName]="tableName"
      [dynamicComponent]="GeometryFormComponent"
      [myService$]="geometries"
      [headers]="headers">
      <tbody tbody>
        @if (geometries.data; as geometryData){
          @for (geometryItem of geometryData | filter: searchValue : ['name','reference'] | sort:sortValue.order:sortValue.field ;track geometryItem.uuid) {
            <tr>
              <td class=" text-center p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                <input type="checkbox" [ngModel]="isCheckOne()" (change)="onCheckOneItem(geometryItem,$event)">
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                <div class="flex px-2">
                  <div class="my-auto flex space-x-1.5 items-center">
                    <div [ngStyle]="{'background-color':geometryItem.color} " class=" rounded-full border w-4 h-4"></div>
                    <h6 class="mb-0 text-sm leading-normal">{{ geometryItem.name }}</h6>
                  </div>
                </div>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                <p class=" flex items-center justify-center mb-0 text-sm font-semibold leading-normal">{{ geometryItem.reference }}</p>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                      <span class="mb-0 text-sm font-semibold leading-normal flex space-x-1.5 items-center ">
                        {{ geometryItem.color }}
                      </span>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                <p class="flex items-center justify-center mb-0 text-sm font-semibold leading-normal">{{ geometryItem.type }}</p>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                <span class="flex items-center justify-center text-xs font-semibold leading-tight">{{ geometryItem._count.coordinates }}</span>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                <select class="flex items-center justify-center text-xs font-semibold leading-tight">
                  @if (geometryItem.coordinates.length > 0) {
                    @for (coordinateItem  of geometryItem.coordinates;track coordinateItem) {
                      <option value="{{ coordinateItem.coordinate_uuid }}"> {{ coordinateItem.coordinate_uuid | truncate:10 }}
                      </option>
                    }
                  } @else {
                    <option value="null">station not found</option>
                  }
                </select>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                <span class="flex items-center justify-center text-xs font-semibold leading-tight">{{ geometryItem.assignedBy }}</span>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                <span class="flex items-center justify-center text-xs font-semibold leading-tight">{{ geometryItem.lastModifiedBy }}</span>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                <span class="flex items-center justify-center text-xs font-semibold leading-tight">{{ geometryItem.updatedAt | date }}</span>
              </td>
              <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                <div class=" space-x-1.5 flex items-center justify-center">
                  <a (click)="onShowDialog(geometryItem)" class="cursor-pointer text-xs font-semibold leading-tight text-slate-400"> <i class="pi pi-file-edit"></i> </a>
                  <a (click)="onConfirmDelete(geometryItem.uuid)" class=" cursor-pointer text-xs font-semibold leading-tight text-slate-400"> <i class="pi pi-trash"></i> </a>
                  <a  class="cursor-pointer text-xs font-semibold leading-tight text-slate-400">
                    <i class="pi pi-eye"></i>
                  </a>
                </div>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="8" class="w-full px-6 py-3 text-xs font-semibold leading-normal text-center bg-transparent border-t border-gray-200 shadow-none whitespace-nowrap">
                <div class="w-full flex flex-row justify-center items-center px-2 ">
                  <div class="">Empty data</div>
                </div>
              </td>
            </tr>
          }
        }
      </tbody>

    </app-table>
  }
</main>
