<main class="flex flex-col -mx-3">

  <!--Forms-->
  <p-toast></p-toast>
  <!--End Forms-->

  <p-confirmDialog></p-confirmDialog>

  @if(directions$()|async; as directions){
    <app-table
      (pageSelectedOutput)="onPaginationChanged($event)"
      (searchValueOutput)="onSearchChanged($event)"
      (perPageOutput)="onChangeEntryPerPage($event)"
      (sortValueOutput)="onSortChanged($event)"
      (reloadTableData)="onReloadTableData($event)"
      [perPage]="perPage"
      [pageSelected]="pageSelected"
      [searchValue]="searchValue"
      [sortColumnSelected]="sortValue"
      [tableName]="tableName"
      [dynamicComponent]="DirectionFormComponent"
      [myService$]="directions"
      [headers]="headers">

      <tbody tbody>
      @if (directions.data; as directionData){
        @for (directionItem of directionData| filter: searchValue : ['name','type','reference'] ;track directionItem.uuid) {
          <tr>
            <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
              <div class="flex items-center justify-center px-2">
                <div class="my-auto">
                  <h6 class="mb-0 text-sm leading-normal">{{ directionItem.name }}</h6>
                </div>
              </div>
            </td>
            <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
              <p class="flex items-center justify-center mb-0 text-sm font-semibold leading-normal">{{ directionItem.geometry.type }}</p>
            </td>
            <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
              <span class="flex items-center justify-center text-xs font-semibold leading-tight">{{ directionItem.reference }}</span>
            </td>
            <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
                    <span
                      class="flex items-center justify-center text-xs font-semibold leading-tight"> {{ directionItem.geometry._count.coordinates }} </span>
            </td>
            <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
              <select class="flex items-center justify-center text-xs font-semibold leading-tight">
                @if (directionItem.geometry.coordinates.length > 0) {
                  @for (coordinateItem  of directionItem.geometry.coordinates;track coordinateItem) {
                    <option value="{{ coordinateItem.coordinate_uuid }}"> {{ coordinateItem.coordinate_uuid | truncate:10}}
                    </option>
                  }
                } @else {
                  <option value="null">station not found</option>
                }
              </select>
            </td>
            <td class="p-2 align-middle bg-transparent border-b whitespace-nowrap shadow-transparent">
              <div class="flex space-x-1.5 items-center justify-center">
                <a (click)="onShowDialog(directionItem)" class="cursor-pointer text-xs font-semibold leading-tight text-slate-400"> <i class="pi pi-file-edit"></i> </a>
                <a (click)="onConfirmDelete(directionItem.uuid)" class=" cursor-pointer text-xs font-semibold leading-tight text-slate-400"> <i class="pi pi-trash"></i> </a>
                <a  class="cursor-pointer text-xs font-semibold leading-tight text-slate-400">
                  <i class="pi pi-eye"></i>
                </a>
              </div>
            </td>
          </tr>
        }@empty {
          <tr>
            <td colspan="8" class="w-full px-6 py-3 text-xs font-semibold leading-normal text-center bg-transparent border-t border-gray-200 shadow-none whitespace-nowrap">
              <div class="w-full flex flex-row justify-center items-center px-2 ">
                <div class="">Empty data</div>
              </div>
            </td>
          </tr>
        }
      }
      </tbody>
    </app-table>
  }
</main>
